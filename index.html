<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>聚宝盆贵金属预测技术工作室自研系统</title>
  <!-- 引入 Vue 3 -->
  <script src="https://unpkg.com/vue@3"></script>
  <!-- 引入 Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* 全局样式重置 + 还原设计风格 */
    * {
      margin: 0; 
      padding: 0; 
      box-sizing: border-box;
      font-family: "Microsoft YaHei", sans-serif;
    }
    body {
      background: #f5f7fa;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }
    .section {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-bottom: 30px;
      padding: 24px;
    }
    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .refresh-btn {
      cursor: pointer;
      color: #409eff;
      font-size: 14px;
    }
    .price-info {
      font-size: 14px;
      line-height: 2;
      color: #666;
    }
    canvas {
      width: 100%!important;
      height: 300px!important;
      margin-top: 16px;
    }
    .history-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    .history-table th,
    .history-table td {
      border: 1px solid #e6e6e6;
      padding: 10px 8px;
      text-align: left;
      font-size: 14px;
      color: #666;
    }
    .history-table th {
      background: #f8f9fa;
      font-weight: 500;
      color: #444;
    }
    .loading {
      color: #999;
      font-style: italic;
      margin-top: 10px;
      display: block;
    }
    /* 响应式适配 */
    @media (max-width: 768px) {
      .section {
        padding: 16px;
      }
      .price-info, .history-table td {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="container">
      <!-- 黄金板块 -->
      <div class="section">
        <div class="section-title">
          <span>黄金价格（元/克）</span>
          <span class="refresh-btn" @click="fetchCurrentPrice">刷新</span>
        </div>
        <div class="price-info">
          当前价格：<span class="text-primary">{{ goldCurrent }}</span><br>
          开盘：<span>{{ goldOpen }}</span> | 最高：<span>{{ goldHigh }}</span> | 最低：<span>{{ goldLow }}</span><br>
          更新时间：<span>{{ goldUpdate }}</span>
        </div>
        <div>
          <div class="section-title" style="margin-bottom: 8px;">黄金价格分时图（今日）</div>
          <canvas id="gold-chart"></canvas>
        </div>
      </div>

      <!-- 白银板块 -->
      <div class="section">
        <div class="section-title">
          <span>白银价格（元/克）</span>
          <span class="refresh-btn" @click="fetchCurrentPrice">刷新</span>
        </div>
        <div class="price-info">
          当前价格：<span class="text-primary">{{ silverCurrent }}</span><br>
          开盘：<span>{{ silverOpen }}</span> | 最高：<span>{{ silverHigh }}</span> | 最低：<span>{{ silverLow }}</span><br>
          更新时间：<span>{{ silverUpdate }}</span>
        </div>
        <div>
          <div class="section-title" style="margin-bottom: 8px;">白银价格分时图（今日）</div>
          <canvas id="silver-chart"></canvas>
        </div>
      </div>

      <!-- 操作建议 -->
      <div class="section">
        <div class="section-title">操作建议（基于实时指标）</div>
        <p class="loading" v-if="!adviceLoaded">加载中...</p>
        <div v-else>
          <p>黄金建议：{{ goldAdvice }}</p>
          <p>白银建议：{{ silverAdvice }}</p>
        </div>
      </div>

      <!-- 历史预测记录 -->
      <div class="section">
        <div class="section-title">历史预测记录（24小时）</div>
        <table class="history-table">
          <thead>
            <tr>
              <th>时间</th>
              <th>黄金建议</th>
              <th>黄金结果</th>
              <th>白银建议</th>
              <th>白银结果</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(item, idx) in historyTable" :key="idx">
              <td>{{ item.time }}</td>
              <td>{{ item.goldAdvice }}</td>
              <td>{{ item.goldResult }}</td>
              <td>{{ item.silverAdvice }}</td>
              <td>{{ item.silverResult }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 收益统计 -->
      <div class="section">
        <div class="section-title">收益统计（基于10000元本金 · 跟随操作建议）</div>
        <p class="loading" v-if="!profitLoaded">加载中...</p>
        <div v-else>
          <p>当日收益：{{ dailyProfit }} 元</p>
          <p>月度收益：{{ monthlyProfit }} 元</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 历史数据（你提供的 gold 和 silver 数组）
    const historyData = {
      gold: [/* 你的 gold 数组数据 */],
      silver: [/* 你的 silver 数组数据 */]
    };

    // 初始化 Vue 应用
    const { createApp } = Vue;
    createApp({
      setup() {
        // 响应式数据
        const goldCurrent = Vue.ref('加载中...');
        const goldOpen = Vue.ref('--');
        const goldHigh = Vue.ref('--');
        const goldLow = Vue.ref('--');
        const goldUpdate = Vue.ref('--');

        const silverCurrent = Vue.ref('加载中...');
        const silverOpen = Vue.ref('--');
        const silverHigh = Vue.ref('--');
        const silverLow = Vue.ref('--');
        const silverUpdate = Vue.ref('--');

        const adviceLoaded = Vue.ref(false);
        const goldAdvice = Vue.ref('');
        const silverAdvice = Vue.ref('');

        const historyTable = Vue.ref([]);
        const profitLoaded = Vue.ref(false);
        const dailyProfit = Vue.ref('');
        const monthlyProfit = Vue.ref('');

        // 初始化图表实例
        let goldChart = null;
        let silverChart = null;

        // 1. 绘制分时图
        function renderChart(canvasId, data, type) {
          const ctx = document.getElementById(canvasId).getContext('2d');
          if (goldChart) goldChart.destroy(); 
          if (silverChart) silverChart.destroy();

          const labels = data.map(item => new Date(item.t).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
          const prices = data.map(item => item.c);

          return new Chart(ctx, {
            type: 'line',
            data: {
              labels: labels,
              datasets: [{
                label: `${type}价格`,
                data: prices,
                borderColor: type === '黄金' ? '#ffd700' : '#c0c0c0',
                backgroundColor: type === '黄金' ? 'rgba(255, 215, 0, 0.1)' : 'rgba(192, 192, 192, 0.1)',
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3,
                pointHoverRadius: 5
              }]
            },
            options: {
              responsive: true,
              scales: {
                x: {
                  title: { display: true, text: '时间' },
                  grid: { display: false }
                },
                y: {
                  title: { display: true, text: '价格（元/克）' },
                  beginAtZero: false,
                  grid: { color: '#eee' }
                }
              },
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: (ctx) => `${type}价格：${ctx.raw} 元/克`
                  }
                }
              }
            }
          });
        }

        // 2. 模拟交易：根据操作建议、历史行情计算收益
        function calculateProfit() {
          // 假设本金 10000 元，简化逻辑：按建议买入/卖出，取历史价格计算
          // 实际需根据真实交易时机（如建议发出时间对应的行情）细化，这里演示核心逻辑
          let goldProfit = 0, silverProfit = 0;
          const principal = 10000;

          // 模拟黄金交易（示例：按建议执行一次买卖）
          if (goldAdvice.value === '买入') {
            // 假设在建议发出时买入，取历史数据最后一条的价格作为买入价
            const buyPrice = historyData.gold.at(-1)?.c || goldCurrent.value; 
            const buyAmount = principal / buyPrice; // 可购买克数
            // 假设当日收盘卖出（取当前价格）
            const sellPrice = goldCurrent.value; 
            goldProfit = buyAmount * (sellPrice - buyPrice);
          } else if (goldAdvice.value === '卖出') {
            // 反向逻辑：假设之前买入，现在卖出
            const sellPrice = goldCurrent.value;
            const buyPrice = historyData.gold[0]?.c || goldOpen.value; 
            const buyAmount = principal / buyPrice;
            goldProfit = buyAmount * (sellPrice - buyPrice);
          }

          // 模拟白银交易（逻辑同黄金）
          if (silverAdvice.value === '买入') {
            const buyPrice = historyData.silver.at(-1)?.c || silverCurrent.value; 
            const buyAmount = principal / buyPrice; 
            const sellPrice = silverCurrent.value; 
            silverProfit = buyAmount * (sellPrice - buyPrice);
          } else if (silverAdvice.value === '卖出') {
            const sellPrice = silverCurrent.value;
            const buyPrice = historyData.silver[0]?.c || silverOpen.value; 
            const buyAmount = principal / buyPrice;
            silverProfit = buyAmount * (sellPrice - buyPrice);
          }

          // 当日收益 = 黄金 + 白银 交易收益
          const daily = (goldProfit + silverProfit).toFixed(2);
          // 月度收益：简单模拟（每日收益累加，这里直接 * 30 演示；实际需按真实交易天数统计）
          const monthly = (daily * 30).toFixed(2); 

          dailyProfit.value = daily;
          monthlyProfit.value = monthly;
        }

        // 3. 拉取并渲染当前价格 + 收益
        async function fetchCurrentPrice() {
          try {
            // 模拟 API 响应（实际替换为真实接口）
            const mockRes = { 
              gold: "788.20", 
              silver: "9.02", 
              updateTime: "7/23/2025, 3:59:52 AM" 
            };

            // 黄金数据渲染
            goldCurrent.value = mockRes.gold;
            const firstGold = historyData.gold[0];
            goldOpen.value = firstGold?.o || '--';
            goldHigh.value = firstGold?.h || '--';
            goldLow.value = firstGold?.l || '--';
            goldUpdate.value = mockRes.updateTime;

            // 白银数据渲染
            silverCurrent.value = mockRes.silver;
            const firstSilver = historyData.silver[0];
            silverOpen.value = firstSilver?.o || '--';
            silverHigh.value = firstSilver?.h || '--';
            silverLow.value = firstSilver?.l || '--';
            silverUpdate.value = mockRes.updateTime;

            // 渲染图表
            goldChart = renderChart('gold-chart', historyData.gold, '黄金');
            silverChart = renderChart('silver-chart', historyData.silver, '白银');

            // 模拟操作建议（实际对接逻辑）
            adviceLoaded.value = true;
            goldAdvice.value = '观望'; 
            silverAdvice.value = '买入';

            // 计算收益
            calculateProfit();
            profitLoaded.value = true;

            // 模拟历史记录（实际从接口/数据解析）
            historyTable.value = [
              { time: '09:00', goldAdvice: '买入', goldResult: '盈利', silverAdvice: '观望', silverResult: '--' },
              { time: '10:00', goldAdvice: '卖出', goldResult: '亏损', silverAdvice: '卖出', silverResult: '盈利' },
            ];

          } catch (err) {
            console.error('数据加载失败：', err);
            alert('网络异常，请重试');
          }
        }

        // 初始化执行
        fetchCurrentPrice();

        return {
          goldCurrent, goldOpen, goldHigh, goldLow, goldUpdate,
          silverCurrent, silverOpen, silverHigh, silverLow, silverUpdate,
          adviceLoaded, goldAdvice, silverAdvice,
          historyTable,
          profitLoaded, dailyProfit, monthlyProfit,
          fetchCurrentPrice
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
