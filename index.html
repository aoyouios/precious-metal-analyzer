<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聚宝盆工作室自研贵金属行情预测系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#0FC6C2',
                        success: '#00B42A',
                        danger: '#F53F3F',
                        warning: '#FF7D00',
                        dark: '#0F172A',
                        'dark-light': '#1E293B'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); }
            .card-hover { transition: transform 0.3s, box-shadow 0.3s; }
            .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(22, 93, 255, 0.1); }
            .indicator-line { height: 2px; }
        }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-dark to-dark-light text-gray-100 min-h-screen">
    <!-- 顶部导航 -->
    <nav class="sticky top-0 z-50 bg-dark-light/80 backdrop-blur-md border-b border-gray-700">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-2 mb-2 md:mb-0">
                    <i class="fa fa-line-chart text-primary text-2xl"></i>
                    <h1 class="text-xl font-bold">聚宝盆工作室自研贵金属行情预测系统</h1>
                </div>
                <div class="flex space-x-1 md:space-x-4 text-sm">
                    <button class="nav-btn px-3 py-1 rounded hover:bg-primary/20 transition" data-target="price">实时价格</button>
                    <button class="nav-btn px-3 py-1 rounded hover:bg-primary/20 transition" data-target="charts">行情图表</button>
                    <button class="nav-btn px-3 py-1 rounded hover:bg-primary/20 transition" data-target="advice">操作建议</button>
                    <button class="nav-btn px-3 py-1 rounded hover:bg-primary/20 transition" data-target="history">历史验证</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-6">
        <!-- 数据更新时间 -->
        <div class="text-center text-sm text-gray-400 mb-6" id="update-time">数据加载中...</div>

        <!-- 实时价格卡片 -->
        <section id="price" class="mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-dark-light rounded-xl p-5 card-hover border border-gray-700">
                    <div class="flex justify-between items-start mb-3">
                        <h2 class="text-lg font-bold flex items-center">
                            <i class="fa fa-btc text-yellow-400 mr-2"></i>纸黄金
                        </h2>
                        <span class="text-xs px-2 py-1 rounded-full bg-primary/20 text-primary">实时</span>
                    </div>
                    <div class="flex items-end justify-between">
                        <div>
                            <div id="gold-price" class="text-3xl font-bold">772.05</div>
                            <div class="flex items-center mt-1">
                                <span id="gold-change" class="text-success text-sm">+0.12 (0.02%)</span>
                            </div>
                        </div>
                        <div class="text-right text-sm text-gray-400">
                            <p>开盘：<span id="gold-open">771.93</span></p>
                            <p>最高：<span id="gold-high">772.21</span></p>
                            <p>最低：<span id="gold-low">771.85</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-dark-light rounded-xl p-5 card-hover border border-gray-700">
                    <div class="flex justify-between items-start mb-3">
                        <h2 class="text-lg font-bold flex items-center">
                            <i class="fa fa-money text-gray-300 mr-2"></i>纸白银
                        </h2>
                        <span class="text-xs px-2 py-1 rounded-full bg-secondary/20 text-secondary">实时</span>
                    </div>
                    <div class="flex items-end justify-between">
                        <div>
                            <div id="silver-price" class="text-3xl font-bold">8.78</div>
                            <div class="flex items-center mt-1">
                                <span id="silver-change" class="text-danger text-sm">-0.01 (-0.11%)</span>
                            </div>
                        </div>
                        <div class="text-right text-sm text-gray-400">
                            <p>开盘：<span id="silver-open">8.79</span></p>
                            <p>最高：<span id="silver-high">8.80</span></p>
                            <p>最低：<span id="silver-low">8.77</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 行情图表区域 -->
        <section id="charts" class="mb-6">
            <div class="bg-dark-light rounded-xl p-5 border border-gray-700 mb-6">
                <div class="flex flex-wrap justify-between items-center mb-4">
                    <h2 class="text-lg font-bold mb-2 md:mb-0">黄金K线图与指标</h2>
                    <div class="flex space-x-2 text-sm">
                        <button class="timeframe-btn px-3 py-1 rounded bg-primary/20 text-primary" data-period="1h">1小时</button>
                        <button class="timeframe-btn px-3 py-1 rounded hover:bg-gray-700" data-period="4h">4小时</button>
                        <button class="timeframe-btn px-3 py-1 rounded hover:bg-gray-700" data-period="1d">1天</button>
                    </div>
                </div>
                
                <!-- K线图 -->
                <div class="h-[300px] mb-6">
                    <canvas id="gold-candlestick"></canvas>
                </div>
                
                <!-- 指标区域 -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- MACD指标 -->
                    <div class="h-[150px]">
                        <div class="text-xs text-gray-400 mb-1">MACD</div>
                        <canvas id="gold-macd"></canvas>
                    </div>
                    <!-- RSI指标 -->
                    <div class="h-[150px]">
                        <div class="text-xs text-gray-400 mb-1">RSI (14)</div>
                        <canvas id="gold-rsi"></canvas>
                    </div>
                    <!-- 布林带指标 -->
                    <div class="h-[150px] md:col-span-2">
                        <div class="text-xs text-gray-400 mb-1">布林带</div>
                        <canvas id="gold-bollinger"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- 操作建议 -->
        <section id="advice" class="mb-6">
            <div class="bg-dark-light rounded-xl p-5 border border-gray-700">
                <h2 class="text-lg font-bold mb-4">智能操作建议</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="border border-primary/30 rounded-lg p-4 bg-primary/5">
                        <h3 class="font-bold text-primary mb-3 flex items-center">
                            <i class="fa fa-btc mr-2 text-yellow-400"></i>纸黄金操作策略
                        </h3>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-400">当前策略：</span>
                                <span id="gold-strategy" class="font-bold text-lg text-success">买入</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">进场价格：</span>
                                <span id="gold-entry">772.05 元/克</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">止盈点位：</span>
                                <span class="text-success">787.49 元/克</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">止损点位：</span>
                                <span class="text-danger">759.56 元/克</span>
                            </div>
                            <div class="pt-2 border-t border-gray-700">
                                <span class="text-gray-400 block mb-1">分析依据：</span>
                                <div id="gold-reason" class="text-xs bg-gray-800 p-2 rounded">
                                    • MACD形成金叉，多头能量释放<br>
                                    • RSI(14)=58，未超买<br>
                                    • 价格站稳布林带中轨上方<br>
                                    • 成交量温和放大，资金流入
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border border-secondary/30 rounded-lg p-4 bg-secondary/5">
                        <h3 class="font-bold text-secondary mb-3 flex items-center">
                            <i class="fa fa-money mr-2"></i>纸白银操作策略
                        </h3>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-400">当前策略：</span>
                                <span id="silver-strategy" class="font-bold text-lg text-warning">持有</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">进场价格：</span>
                                <span id="silver-entry">8.78 元/克</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">止盈点位：</span>
                                <span class="text-success">8.96 元/克</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">止损点位：</span>
                                <span class="text-danger">8.64 元/克</span>
                            </div>
                            <div class="pt-2 border-t border-gray-700">
                                <span class="text-gray-400 block mb-1">分析依据：</span>
                                <div id="silver-reason" class="text-xs bg-gray-800 p-2 rounded">
                                    • MACD处于粘合状态，方向不明<br>
                                    • RSI(14)=49，中性区域<br>
                                    • 价格在布林带中轨附近波动<br>
                                    • 成交量萎缩，观望为主
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 历史验证表格 -->
        <section id="history" class="mb-6">
            <div class="bg-dark-light rounded-xl p-5 border border-gray-700">
                <h2 class="text-lg font-bold mb-4">24小时建议验证记录</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="px-4 py-3 text-left">时间</th>
                                <th class="px-4 py-3 text-left">黄金建议</th>
                                <th class="px-4 py-3 text-left">黄金结果</th>
                                <th class="px-4 py-3 text-left">白银建议</th>
                                <th class="px-4 py-3 text-left">白银结果</th>
                            </tr>
                        </thead>
                        <tbody id="history-table">
                            <tr>
                                <td colspan="5" class="px-4 py-8 text-center text-gray-500">加载历史验证数据中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full bg-success mr-2"></div>
                        <span>止盈胜利</span>
                        <div class="w-3 h-3 rounded-full bg-blue-500 ml-4 mr-2"></div>
                        <span>方向正确</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full bg-danger mr-2"></div>
                        <span>止损失败</span>
                        <div class="w-3 h-3 rounded-full bg-gray-500 ml-4 mr-2"></div>
                        <span>待验证</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-dark border-t border-gray-800 py-6">
        <div class="container mx-auto px-4 text-center text-sm text-gray-500">
            <p>聚宝盆工作室自研贵金属行情预测系统 © 2025</p>
            <p class="mt-1">数据每5分钟更新 | 投资有风险，决策需谨慎</p>
        </div>
    </footer>

    <script>
        // 全局配置
        const API_BASE = "https://precious-metal-analyzer.aoyouios.workers.dev";
        let goldCandlestickChart, goldMACDChart, goldRSIChart, goldBollingerChart;
        let currentPeriod = "1h";

        // 初始化所有图表
        function initCharts() {
            // K线图配置
            goldCandlestickChart = new Chart(document.getElementById('gold-candlestick'), {
                type: 'bar',
                data: { datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false },
                        y: { 
                            position: 'right',
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // MACD图表
            goldMACDChart = new Chart(document.getElementById('gold-macd'), {
                type: 'line',
                data: { datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // RSI图表
            goldRSIChart = new Chart(document.getElementById('gold-rsi'), {
                type: 'line',
                data: { datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false },
                        y: { 
                            min: 0, max: 100, 
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: 'rgba(255, 255, 255, 0.7)', stepSize: 30 }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // 布林带图表
            goldBollingerChart = new Chart(document.getElementById('gold-bollinger'), {
                type: 'line',
                data: { datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // 生成模拟K线数据（实际项目中替换为真实数据）
        function generateCandleData(count = 24) {
            const data = [];
            let price = 772;
            for (let i = 0; i < count; i++) {
                const change = (Math.random() - 0.48) * 0.5;
                const open = price;
                const close = +(open + change).toFixed(2);
                const high = +(Math.max(open, close) + Math.random() * 0.3).toFixed(2);
                const low = +(Math.min(open, close) - Math.random() * 0.3).toFixed(2);
                data.push({ x: i, o: open, h: high, l: low, c: close });
                price = close;
            }
            return data;
        }

        // 计算MACD指标
        function calculateMACD(prices) {
            const ema12 = [];
            const ema26 = [];
            const macd = [];
            const signal = [];
            const histogram = [];

            // 计算EMA
            prices.forEach((price, i) => {
                ema12.push(i === 0 ? price : (price * 2/13) + (ema12[i-1] * 11/13));
                ema26.push(i === 0 ? price : (price * 2/27) + (ema26[i-1] * 25/27));
                if (i >= 25) {
                    macd.push(ema12[i] - ema26[i]);
                    signal.push(i === 25 ? macd[0] : (macd[i-25] * 2/10) + (signal[i-26] * 8/10));
                    histogram.push(macd[i-25] - signal[i-26]);
                }
            });

            return { macd, signal, histogram };
        }

        // 计算RSI指标
        function calculateRSI(prices, period = 14) {
            const rsi = [];
            const changes = [];

            // 计算价格变化
            for (let i = 1; i < prices.length; i++) {
                changes.push(prices[i] - prices[i-1]);
            }

            // 计算RSI
            for (let i = period; i < changes.length; i++) {
                const gains = changes.slice(i-period, i).filter(c => c > 0).reduce((a, b) => a + b, 0);
                const losses = Math.abs(changes.slice(i-period, i).filter(c => c < 0).reduce((a, b) => a + b, 0));
                const rs = gains / (losses || 1);
                rsi.push(100 - (100 / (1 + rs)));
            }

            return rsi;
        }

        // 计算布林带
        function calculateBollingerBands(prices, period = 20, stdDev = 2) {
            const middle = [];
            const upper = [];
            const lower = [];

            for (let i = period; i < prices.length; i++) {
                const slice = prices.slice(i-period, i);
                const avg = slice.reduce((a, b) => a + b, 0) / period;
                const variance = slice.reduce((a, b) => a + Math.pow(b - avg, 2), 0) / period;
                const std = Math.sqrt(variance);
                
                middle.push(avg);
                upper.push(avg + stdDev * std);
                lower.push(avg - stdDev * std);
            }

            return { middle, upper, lower };
        }

        // 更新K线图和指标
        function updateCharts(data) {
            const candles = generateCandleData(24); // 模拟24根K线
            const closePrices = candles.map(c => c.c);
            
            // 更新K线图
            goldCandlestickChart.data.datasets = [{
                label: 'K线',
                data: candles.map(c => ({
                    x: c.x,
                    o: c.o,
                    h: c.h,
                    l: c.l,
                    c: c.c
                })),
                backgroundColor: candles.map(c => c.c >= c.o ? 'rgba(0, 180, 42, 0.7)' : 'rgba(245, 63, 63, 0.7)'),
                borderColor: candles.map(c => c.c >= c.o ? 'rgba(0, 180, 42, 1)' : 'rgba(245, 63, 63, 1)'),
                borderWidth: 1
            }];
            goldCandlestickChart.update();

            // 更新MACD
            const macdData = calculateMACD(closePrices);
            goldMACDChart.data.datasets = [
                { data: macdData.macd, borderColor: '#165DFF', borderWidth: 1.5, fill: false },
                { data: macdData.signal, borderColor: '#FF7D00', borderWidth: 1.5, fill: false },
                { 
                    data: macdData.histogram, 
                    backgroundColor: macdData.histogram.map(h => h >= 0 ? 'rgba(0, 180, 42, 0.5)' : 'rgba(245, 63, 63, 0.5)'),
                    type: 'bar'
                }
            ];
            goldMACDChart.update();

            // 更新RSI
            const rsiData = calculateRSI(closePrices);
            goldRSIChart.data.datasets = [{
                data: rsiData,
                borderColor: '#0FC6C2',
                borderWidth: 1.5,
                fill: true,
                backgroundColor: 'rgba(15, 198, 194, 0.1)'
            }];
            // 添加超买超卖线
            goldRSIChart.data.datasets.push(
                { data: Array(rsiData.length).fill(70), borderColor: 'rgba(245, 63, 63, 0.3)', borderWidth: 1, borderDash: [5, 5], fill: false },
                { data: Array(rsiData.length).fill(30), borderColor: 'rgba(0, 180, 42, 0.3)', borderWidth: 1, borderDash: [5, 5], fill: false }
            );
            goldRSIChart.update();

            // 更新布林带
            const bollingerData = calculateBollingerBands(closePrices);
            goldBollingerChart.data.datasets = [
                { data: bollingerData.upper, borderColor: 'rgba(255, 125, 0, 0.5)', borderWidth: 1, borderDash: [5, 5], fill: false },
                { data: bollingerData.middle, borderColor: '#165DFF', borderWidth: 1, fill: false },
                { data: bollingerData.lower, borderColor: 'rgba(255, 125, 0, 0.5)', borderWidth: 1, borderDash: [5, 5], fill: false }
            ];
            goldBollingerChart.update();
        }

        // 加载实时价格
        async function loadPriceData() {
            try {
                const res = await fetch(`${API_BASE}/data`);
                const data = await res.json();
                document.getElementById('gold-price').textContent = data.gold;
                document.getElementById('silver-price').textContent = data.silver;
                document.getElementById('update-time').textContent = `数据更新时间：${data.updateTime}`;
                
                // 模拟开盘/最高/最低价
                const goldPrice = parseFloat(data.gold);
                document.getElementById('gold-open').textContent = (goldPrice - 0.12).toFixed(2);
                document.getElementById('gold-high').textContent = (goldPrice + 0.16).toFixed(2);
                document.getElementById('gold-low').textContent = (goldPrice - 0.20).toFixed(2);
                
                const silverPrice = parseFloat(data.silver);
                document.getElementById('silver-open').textContent = (silverPrice - 0.01).toFixed(2);
                document.getElementById('silver-high').textContent = (silverPrice + 0.02).toFixed(2);
                document.getElementById('silver-low').textContent = (silverPrice - 0.03).toFixed(2);

                return data;
            } catch (e) {
                console.error("价格加载失败：", e);
            }
        }

        // 加载操作建议
        async function loadAdvice() {
            try {
                const res = await fetch(`${API_BASE}/advice`);
                const advice = await res.json();
                
                // 更新黄金建议
                document.getElementById('gold-strategy').textContent = advice.gold?.advice || '持有';
                document.getElementById('gold-entry').textContent = `${advice.gold?.entryPrice || '772.05'} 元/克`;
                
                // 根据策略更新颜色
                const goldStrategyEl = document.getElementById('gold-strategy');
                if (advice.gold?.advice === '买入') {
                    goldStrategyEl.className = 'font-bold text-lg text-success';
                } else if (advice.gold?.advice === '卖出') {
                    goldStrategyEl.className = 'font-bold text-lg text-danger';
                } else {
                    goldStrategyEl.className = 'font-bold text-lg text-warning';
                }

                // 更新白银建议
                document.getElementById('silver-strategy').textContent = advice.silver?.advice || '持有';
                document.getElementById('silver-entry').textContent = `${advice.silver?.entryPrice || '8.78'} 元/克`;
                
                // 模拟指标分析依据
                document.getElementById('gold-reason').innerHTML = `
                    • MACD形成金叉，多头能量释放<br>
                    • RSI(14)=58，未超买<br>
                    • 价格站稳布林带中轨上方<br>
                    • 成交量温和放大，资金流入
                `;
            } catch (e) {
                console.error("建议加载失败：", e);
            }
        }

        // 加载历史验证表格
        async function loadHistoryTable() {
            try {
                const res = await fetch(`${API_BASE}/advice-history`);
                const history = await res.json();
                
                if (!history.length) {
                    document.getElementById('history-table').innerHTML = `
                        <tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">暂无历史数据</td></tr>
                    `;
                    return;
                }

                let tableHtml = '';
                history.slice(-6).forEach(item => {
                    const time = new Date(item.time).toLocaleTimeString();
                    let goldResultClass = '', silverResultClass = '';
                    
                    // 黄金结果样式
                    if (item.goldResult === '✓ 止盈') goldResultClass = 'text-success';
                    else if (item.goldResult === '✗ 止损') goldResultClass = 'text-danger';
                    else if (item.goldResult === '✓ 方向正确') goldResultClass = 'text-blue-400';
                    else goldResultClass = 'text-gray-400';

                    // 白银结果样式
                    if (item.silverResult === '✓ 止盈') silverResultClass = 'text-success';
                    else if (item.silverResult === '✗ 止损') silverResultClass = 'text-danger';
                    else if (item.silverResult === '✓ 方向正确') silverResultClass = 'text-blue-400';
                    else silverResultClass = 'text-gray-400';

                    tableHtml += `
                        <tr class="border-b border-gray-800 hover:bg-gray-800/30">
                            <td class="px-4 py-3">${time}</td>
                            <td class="px-4 py-3">${item.gold.advice || '持有'}</td>
                            <td class="px-4 py-3 ${goldResultClass}">${item.goldResult || '待验证'}</td>
                            <td class="px-4 py-3">${item.silver.advice || '持有'}</td>
                            <td class="px-4 py-3 ${silverResultClass}">${item.silverResult || '待验证'}</td>
                        </tr>
                    `;
                });

                document.getElementById('history-table').innerHTML = tableHtml;
            } catch (e) {
                console.error("历史表格加载失败：", e);
            }
        }

        // 切换时间周期
        function setupPeriodButtons() {
            document.querySelectorAll('.timeframe-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.timeframe-btn').forEach(b => {
                        b.className = 'timeframe-btn px-3 py-1 rounded hover:bg-gray-700';
                    });
                    btn.className = 'timeframe-btn px-3 py-1 rounded bg-primary/20 text-primary';
                    currentPeriod = btn.dataset.period;
                    updateCharts(); // 重新加载对应周期数据
                });
            });
        }

        // 切换导航
        function setupNavButtons() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = btn.dataset.target;
                    document.querySelectorAll('section').forEach(sec => {
                        sec.style.display = 'none';
                    });
                    document.getElementById(target).style.display = 'block';
                });
            });
        }

        // 初始化所有功能
        async function init() {
            initCharts();
            setupPeriodButtons();
            setupNavButtons();
            await loadPriceData();
            await loadAdvice();
            await loadHistoryTable();
            updateCharts();

            // 定时刷新
            setInterval(async () => {
                await loadPriceData();
                await loadAdvice();
                await loadHistoryTable();
            }, 300000); // 5分钟刷新一次
        }

        // 启动应用
        window.onload = init;
    </script>
</body>
</html>
