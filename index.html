<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>聚宝盆贵金属预测技术工作室自研系统</title>
  <script src="https://cdn.tailwindcss.com?v=3.3.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 苹果风格配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0071e3',
            success: '#34c759',
            danger: '#ff3b30',
            neutral: '#86868b',
            pending: '#ffcc00',
            apple: {
              light: '#f5f5f7',
              card: '#ffffff',
              border: '#e2e2e7'
            }
          },
          fontFamily: {
            sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
          },
        }
      }
    }
  </script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #f5f5f7 !important; color: #1d1d1f !important; }
    
    /* 分时图容器 */
    .line-chart-container { 
      height: 400px !important; 
      width: 100% !important; 
      position: relative;
      overflow: hidden;
    }
    .chart-loading {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.8);
      z-index: 10;
    }
    canvas { 
      display: block !important; 
      width: 100% !important;
      height: 100% !important;
    }
    
    /* 表格样式 */
    table { border-collapse: collapse; width: 100%; }
    .table-header {
      position: sticky;
      top: 0;
      z-index: 2;
    }
    
    .result-tag {
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .profit-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .profit-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
  </style>
</head>

<body>
  <!-- 顶部导航 -->
  <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-apple-border">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center">
        <i class="fa fa-diamond text-primary mr-2"></i>
        <h1 class="font-semibold">聚宝盆贵金属预测技术工作室自研系统</h1>
      </div>
      <span id="system-time" class="text-neutral text-sm">加载中...</span>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6">
    <!-- 价格卡片 -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div class="bg-apple-card rounded-xl p-5 shadow-sm">
        <h2 class="text-neutral text-sm mb-2">黄金价格（元/克）</h2>
        <div class="text-3xl font-semibold mb-2" id="gold-price">772.05</div>
        <div class="text-sm mb-1">
          <span id="gold-change" class="text-success">+1.25%（今日）</span>
        </div>
        <div class="text-xs text-neutral mb-4">
          开盘：<span id="gold-open">762.50</span> 元/克 | 最高：<span id="gold-high">773.20</span> 元/克 | 最低：<span id="gold-low">761.80</span> 元/克
        </div>
        <div class="flex justify-between text-sm">
          <span class="text-neutral">更新时间：<span id="gold-time">2025/7/24 16:45</span></span>
          <button id="refresh-gold" class="text-primary hover:underline">
            <i class="fa fa-refresh mr-1"></i>刷新
          </button>
        </div>
      </div>
      
      <div class="bg-apple-card rounded-xl p-5 shadow-sm">
        <h2 class="text-neutral text-sm mb-2">白银价格（元/克）</h2>
        <div class="text-3xl font-semibold mb-2" id="silver-price">8.78</div>
        <div class="text-sm mb-1">
          <span id="silver-change" class="text-danger">-0.23%（今日）</span>
        </div>
        <div class="text-xs text-neutral mb-4">
          开盘：<span id="silver-open">8.80</span> 元/克 | 最高：<span id="silver-high">8.85</span> 元/克 | 最低：<span id="silver-low">8.75</span> 元/克
        </div>
        <div class="flex justify-between text-sm">
          <span class="text-neutral">更新时间：<span id="silver-time">2025/7/24 16:45</span></span>
          <button id="refresh-silver" class="text-primary hover:underline">
            <i class="fa fa-refresh mr-1"></i>刷新
          </button>
        </div>
      </div>
    </div>

    <!-- 黄金分时图 -->
    <div class="bg-apple-card rounded-xl p-5 shadow-sm mb-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="font-medium">黄金价格分时图（今日）</h2>
        <div class="text-sm text-neutral">
          数据点：<span id="gold-data-count">0</span>个 | 时间范围：<span id="gold-time-range">--</span>
        </div>
      </div>
      <div class="line-chart-container">
        <div id="gold-chart-loading" class="chart-loading">
          <i class="fa fa-circle-o-notch fa-spin text-primary text-2xl"></i>
        </div>
        <canvas id="gold-line"></canvas>
        <div id="gold-chart-error" class="chart-loading hidden">
          <div class="text-center">
            <i class="fa fa-exclamation-triangle text-danger mb-2"></i>
            <p>图表加载失败，点击重试</p>
            <button onclick="initGoldChart()" class="mt-2 text-primary text-sm">重试</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 白银分时图 -->
    <div class="bg-apple-card rounded-xl p-5 shadow-sm mb-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="font-medium">白银价格分时图（今日）</h2>
        <div class="text-sm text-neutral">
          数据点：<span id="silver-data-count">0</span>个 | 时间范围：<span id="silver-time-range">--</span>
        </div>
      </div>
      <div class="line-chart-container">
        <div id="silver-chart-loading" class="chart-loading">
          <i class="fa fa-circle-o-notch fa-spin text-primary text-2xl"></i>
        </div>
        <canvas id="silver-line"></canvas>
        <div id="silver-chart-error" class="chart-loading hidden">
          <div class="text-center">
            <i class="fa fa-exclamation-triangle text-danger mb-2"></i>
            <p>图表加载失败，点击重试</p>
            <button onclick="initSilverChart()" class="mt-2 text-primary text-sm">重试</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 操作建议 -->
    <div class="bg-apple-card rounded-xl p-5 shadow-sm mb-6">
      <h2 class="font-medium mb-6">操作建议（基于实时指标）</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="p-5 border border-apple-border rounded-lg">
          <h3 class="font-medium mb-4 flex items-center">
            <i class="fa fa-diamond text-primary mr-2"></i>黄金操作建议
          </h3>
          
          <div class="space-y-4 text-sm">
            <div>
              <span class="block text-neutral mb-1">核心建议：</span>
              <span class="text-lg font-semibold text-success">买入</span>
            </div>
            
            <div class="p-3 bg-apple-light rounded-lg">
              <span class="block font-medium mb-2">指标依据：</span>
              <ul class="list-disc list-inside space-y-1 text-neutral">
                <li>今日开盘价762.50元，当前价772.05元，涨幅1.25%</li>
                <li>全天呈单边上涨趋势，未出现明显回调</li>
                <li>最近1小时成交量较前一小时增加15%</li>
                <li>相对开盘价溢价空间稳定扩大</li>
              </ul>
            </div>
            
            <div class="grid grid-cols-2 gap-2">
              <div>
                <span class="block text-neutral">止盈价</span>
                <span class="font-medium text-success">787.49 元/克</span>
              </div>
              <div>
                <span class="block text-neutral">止损价</span>
                <span class="font-medium text-danger">756.61 元/克</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="p-5 border border-apple-border rounded-lg">
          <h3 class="font-medium mb-4 flex items-center">
            <i class="fa fa-cubes text-primary mr-2"></i>白银操作建议
          </h3>
          
          <div class="space-y-4 text-sm">
            <div>
              <span class="block text-neutral mb-1">核心建议：</span>
              <span class="text-lg font-semibold text-neutral">观望</span>
            </div>
            
            <div class="p-3 bg-apple-light rounded-lg">
              <span class="block font-medium mb-2">指标依据：</span>
              <ul class="list-disc list-inside space-y-1 text-neutral">
                <li>今日开盘价8.80元，当前价8.78元，微跌0.23%</li>
                <li>价格在窄幅区间内波动，振幅仅0.10元</li>
                <li>成交量持续萎缩，市场交投清淡</li>
                <li>相对开盘价始终在±0.3%范围内波动</li>
              </ul>
            </div>
            
            <div class="grid grid-cols-2 gap-2">
              <div>
                <span class="block text-neutral">止盈价</span>
                <span class="font-medium text-success">8.95 元/克</span>
              </div>
              <div>
                <span class="block text-neutral">止损价</span>
                <span class="font-medium text-danger">8.60 元/克</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-apple-card border-t border-apple-border mt-8">
    <div class="max-w-7xl mx-auto px-4 py-6 text-center text-neutral text-sm">
      © 2025 聚宝盆贵金属预测技术工作室 | 数据每5分钟更新一次
    </div>
  </footer>

  <script>
    // 全局变量
    let goldData = [], silverData = [];
    let goldLineChart = null, silverLineChart = null;
    // 直接使用提供的历史数据
    const PROVIDED_HISTORY = {"gold":[{"t":1753154646239,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753154665850,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753154703262,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753154739985,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753154871102,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753154966906,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753154967567,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753155007005,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753155057626,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753155260982,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753155262034,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753155339277,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753155482399,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753155694179,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753155694677,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753156184243,"o":772.05,"h":772.05,"l":772.05,"c":772.05},{"t":1753156559438,"o":772.05,"h":782.04,"l":772.05,"c":782.04},{"t":1753156588725,"o":782.04,"h":782.11,"l":782.04,"c":782.11},{"t":1753156622112,"o":782.11,"h":782.11,"l":782.09,"c":782.09},{"t":1753156643677,"o":782.09,"h":782.09,"l":781.91,"c":781.91},{"t":1753156915967,"o":781.91,"h":781.91,"l":781.9,"c":781.9},{"t":1753156943024,"o":781.9,"h":781.9,"l":781.9,"c":781.9},{"t":1753157216370,"o":781.9,"h":781.9,"l":781.45,"c":781.45},{"t":1753157246895,"o":781.45,"h":781.45,"l":781.25,"c":781.25},{"t":1753157376232,"o":781.25,"h":781.41,"l":781.25,"c":781.41},{"t":1753157512496,"o":781.41,"h":781.5,"l":781.41,"c":781.5},{"t":1753158105723,"o":781.5,"h":781.5,"l":781.29,"c":781.29},{"t":1753158109589,"o":781.29,"h":781.29,"l":781.29,"c":781.29},{"t":1753158344452,"o":781.29,"h":781.51,"l":781.29,"c":781.51},{"t":1753158456249,"o":781.51,"h":781.51,"l":781.44,"c":781.44},{"t":1753158645918,"o":781.44,"h":781.44,"l":781.32,"c":781.32},{"t":1753158756879,"o":781.32,"h":781.32,"l":781.31,"c":781.31},{"t":1753158797187,"o":781.31,"h":781.35,"l":781.31,"c":781.35},{"t":1753158943978,"o":781.35,"h":781.35,"l":781.26,"c":781.26},{"t":1753159058231,"o":781.26,"h":781.38,"l":781.26,"c":781.38},{"t":1753159097924,"o":781.38,"h":781.38,"l":781.29,"c":781.29},{"t":1753159243561,"o":781.29,"h":781.29,"l":781.09,"c":781.09},{"t":1753159398789,"o":781.09,"h":781.12,"l":781.09,"c":781.12},{"t":1753159543613,"o":781.12,"h":781.29,"l":781.12,"c":781.29},{"t":1753159697215,"o":781.29,"h":781.29,"l":781.13,"c":781.13},{"t":1753159857043,"o":781.13,"h":781.13,"l":781.09,"c":781.09},{"t":1753159957324,"o":781.09,"h":781.1,"l":781.09,"c":781.1},{"t":1753159996615,"o":781.1,"h":781.1,"l":781.1,"c":781.1},{"t":1753160158484,"o":781.1,"h":781.36,"l":781.1,"c":781.36},{"t":1753160255901,"o":781.36,"h":781.5,"l":781.36,"c":781.5},{"t":1753160336846,"o":781.5,"h":781.7,"l":781.5,"c":781.7},{"t":1753160458329,"o":781.7,"h":781.82,"l":781.7,"c":781.82},{"t":1753160636405,"o":781.82,"h":781.82,"l":781.26,"c":781.26},{"t":1753160757486,"o":781.26,"h":781.47,"l":781.26,"c":781.47},{"t":1753160865115,"o":781.47,"h":781.47,"l":781.35,"c":781.35},{"t":1753160937056,"o":781.35,"h":781.35,"l":781.27,"c":781.27},{"t":1753161056239,"o":781.27,"h":781.27,"l":781.24,"c":781.24},{"t":1753161155760,"o":781.24,"h":781.24,"l":781.18,"c":781.18},{"t":1753161236021,"o":781.18,"h":781.18,"l":781.06,"c":781.06},{"t":1753161356675,"o":781.06,"h":781.07,"l":781.06,"c":781.07},{"t":1753161456133,"o":781.07,"h":781.07,"l":780.88,"c":780.88},{"t":1753161536251,"o":780.88,"h":780.89,"l":780.88,"c":780.89},{"t":1753161656133,"o":780.89,"h":780.89,"l":780.87,"c":780.87},{"t":1753161757417,"o":780.87,"h":780.94,"l":780.87,"c":780.94},{"t":1753161956030,"o":780.94,"h":780.94,"l":780.91,"c":780.91},{"t":1753162055760,"o":780.91,"h":780.98,"l":780.91,"c":780.98},{"t":1753162138971,"o":780.98,"h":781.03,"l":780.98,"c":781.03},{"t":1753162258455,"o":781.03,"h":781.03,"l":780.93,"c":780.93},{"t":1753162357143,"o":780.93,"h":781.04,"l":780.93,"c":781.04},{"t":1753162436023,"o":781.04,"h":781.04,"l":781.01,"c":781.01},{"t":1753162557628,"o":781.01,"h":781.24,"l":781.01,"c":781.24},{"t":1753162742423,"o":781.24,"h":781.24,"l":780.91,"c":780.91},{"t":1753163037359,"o":780.91,"h":780.91,"l":780.65,"c":780.65},{"t":1753163155777,"o":780.65,"h":780.65,"l":780.55,"c":780.55},{"t":1753163255947,"o":780.55,"h":780.55,"l":780.5,"c":780.5},{"t":1753163336177,"o":780.5,"h":780.67,"l":780.5,"c":780.67},{"t":1753163457063,"o":780.67,"h":780.69,"l":780.67,"c":780.69},{"t":1753163555394,"o":780.69,"h":780.69,"l":780.55,"c":780.55},{"t":1753163636067,"o":780.55,"h":780.55,"l":780.5,"c":780.5},{"t":1753163756492,"o":780.5,"h":780.5,"l":780.3,"c":780.3},{"t":1753163855758,"o":780.3,"h":780.48,"l":780.3,"c":780.48},{"t":1753163936109,"o":780.48,"h":780.48,"l":780.42,"c":780.42},{"t":1753164157722,"o":780.42,"h":780.42,"l":780.3,"c":780.3},{"t":1753164355768,"o":780.3,"h":780.81,"l":780.3,"c":780.81},{"t":1753164535988,"o":780.81,"h":780.9,"l":780.81,"c":780.9},{"t":1753164655951,"o":780.9,"h":780.9,"l":780.73,"c":780.73},{"t":1753164756128,"o":780.73,"h":780.79,"l":780.73,"c":780.79},{"t":1753164837196,"o":780.79,"h":780.79,"l":780.7,"c":780.7},{"t":1753164955906,"o":780.7,"h":780.7,"l":780.68,"c":780.68},{"t":1753165056099,"o":780.68,"h":780.68,"l":780.67,"c":780.67},{"t":1753165135609,"o":780.67,"h":780.75,"l":780.67,"c":780.75},{"t":1753165256097,"o":780.75,"h":780.9,"l":780.75,"c":780.9},{"t":1753165358083,"o":780.9,"h":780.9,"l":780.63,"c":780.63},{"t":1753165435882,"o":780.63,"h":780.63,"l":780.56,"c":780.56},{"t":1753165654994,"o":780.56,"h":780.56,"l":780.46,"c":780.46},{"t":1753165737850,"o":780.46,"h":780.46,"l":780.33,"c":780.33},{"t":1753165857796,"o":780.33,"h":780.33,"l":780.32,"c":780.32},{"t":1753165955240,"o":780.32,"h":780.49,"l":780.32,"c":780.49},{"t":1753166036056,"o":780.49,"h":780.58,"l":780.49,"c":780.58},{"t":1753166157446,"o":780.58,"h":780.69,"l":780.58,"c":780.69},{"t":1753166256181,"o":780.69,"h":780.69,"l":780.39,"c":780.39},{"t":1753166338305,"o":780.39,"h":780.39,"l":780.31,"c":780.31},{"t":1753166456374,"o":780.31,"h":780.33,"l":780.31,"c":780.33},{"t":1753166556233,"o":780.33,"h":780.37,"l":780.33,"c":780.37},{"t":1753166596359,"o":780.37,"h":780.37,"l":780.34,"c":780.34},{"t":1753166818889,"o":780.34,"h":780.45,"l":780.34,"c":780.45},{"t":1753166823183,"o":780.45,"h":780.45,"l":780.45,"c":780.45},{"t":1753166935205,"o":780.45,"h":780.45,"l":780.4,"c":780.4},{"t":1753167551585,"o":780.4,"h":780.53,"l":780.4,"c":780.53},{"t":1753167563134,"o":780.53,"h":780.53,"l":780.52,"c":780.52},{"t":1753167579381,"o":780.52,"h":780.52,"l":780.46,"c":780.46},{"t":1753167599227,"o":780.46,"h":780.46,"l":780.44,"c":780.44},{"t":1753167918928,"o":780.44,"h":780.48,"l":780.44,"c":780.48},{"t":1753167963220,"o":780.48,"h":780.48,"l":780.37,"c":780.37},{"t":1753168612195,"o":780.37,"h":780.39,"l":780.37,"c":780.39},{"t":1753172863713,"o":780.39,"h":781.6,"l":780.39,"c":781.6},{"t":1753172898191,"o":781.6,"h":781.6,"l":781.52,"c":781.52},{"t":1753176066066,"o":781.52,"h":781.52,"l":781.18,"c":781.18},{"t":1753177356252,"o":781.18,"h":781.18,"l":780.96,"c":780.96}],"silver":[{"t":1753154646239,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753154665850,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753154703262,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753154739985,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753154871102,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753154966906,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753154967567,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753155007005,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753155057626,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753155260982,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753155262034,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753155339277,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753155482399,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753155694179,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753155694677,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753156184243,"o":8.78,"h":8.78,"l":8.78,"c":8.78},{"t":1753156559438,"o":8.78,"h":8.95,"l":8.78,"c":8.95},{"t":1753156588725,"o":8.95,"h":8.95,"l":8.95,"c":8.95},{"t":1753156622112,"o":8.95,"h":8.95,"l":8.95,"c":8.95},{"t":1753156643677,"o":8.95,"h":8.95,"l":8.95,"c":8.95},{"t":1753156915967,"o":8.95,"h":8.95,"l":8.94,"c":8.94},{"t":1753156943024,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753157216370,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753157246895,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753157376232,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753157512496,"o":8.94,"h":8.94,"l":8.93,"c":8.93},{"t":1753158105723,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753158109589,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753158344452,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753158456249,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753158645918,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753158756879,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753158797187,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753158943978,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753159058231,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753159097924,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753159243561,"o":8.93,"h":8.93,"l":8.92,"c":8.92},{"t":1753159398789,"o":8.92,"h":8.92,"l":8.92,"c":8.92},{"t":1753159543613,"o":8.92,"h":8.93,"l":8.92,"c":8.93},{"t":1753159697215,"o":8.93,"h":8.93,"l":8.92,"c":8.92},{"t":1753159857043,"o":8.92,"h":8.92,"l":8.92,"c":8.92},{"t":1753159957324,"o":8.92,"h":8.92,"l":8.92,"c":8.92},{"t":1753159996615,"o":8.92,"h":8.92,"l":8.92,"c":8.92},{"t":1753160158484,"o":8.92,"h":8.92,"l":8.92,"c":8.92},{"t":1753160255901,"o":8.92,"h":8.92,"l":8.92,"c":8.92},{"t":1753160336846,"o":8.92,"h":8.93,"l":8.92,"c":8.93},{"t":1753160458329,"o":8.93,"h":8.94,"l":8.93,"c":8.94},{"t":1753160636405,"o":8.94,"h":8.94,"l":8.92,"c":8.92},{"t":1753160757486,"o":8.92,"h":8.92,"l":8.92,"c":8.92},{"t":1753160865115,"o":8.92,"h":8.93,"l":8.92,"c":8.93},{"t":1753160937056,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753161056239,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753161155760,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753161236021,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753161356675,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753161456133,"o":8.93,"h":8.94,"l":8.93,"c":8.94},{"t":1753161536251,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753161656133,"o":8.94,"h":8.94,"l":8.93,"c":8.93},{"t":1753161757417,"o":8.93,"h":8.94,"l":8.93,"c":8.94},{"t":1753161956030,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753162055760,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753162138971,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753162258455,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753162357143,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753162436023,"o":8.94,"h":8.94,"l":8.94,"c":8.94},{"t":1753162557628,"o":8.94,"h":8.95,"l":8.94,"c":8.95},{"t":1753162742423,"o":8.95,"h":8.95,"l":8.94,"c":8.94},{"t":1753163037359,"o":8.94,"h":8.94,"l":8.93,"c":8.93},{"t":1753163155777,"o":8.93,"h":8.93,"l":8.92,"c":8.92},{"t":1753163255947,"o":8.92,"h":8.93,"l":8.92,"c":8.93},{"t":1753163336177,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753163457063,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753163555394,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753163636067,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753163756492,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753163855758,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753163936109,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753164157722,"o":8.93,"h":8.93,"l":8.93,"c":8.93},{"t":1753164355768,"o":8.93,"h":8.94,"l":8.93,"c":8.94},{"t":1753164535988,"o":8.94,"h":8.94,"l":8.93,"c":8.93},{"t":1753164655951,"o":8.93,"h":8.94,"l":8.93,"c":8.94},{"t":1753164756128,"o":8.94,"h":8.95,"l":8.94,"c":8.95},{"t":1753164837196,"o":8.95,"h":8.95,"l":8.95,"c":8.95},{"t":1753164955906,"o":8.95,"h":8.95,"l":8.95,"c":8.95},{"t":1753165056099,"o":8.95,"h":8.95,"l":8.95,"c":8.95},{"t":1753165135609,"o":8.95,"h":8.95,"l":8.95,"c":8.95},{"t":1753165256097,"o":8.95,"h":8.96,"l":8.95,"c":8.96},{"t":1753165358083,"o":8.96,"h":8.96,"l":8.95,"c":8.95},{"t":1753165435882,"o":8.95,"h":8.95,"l":8.95,"c":8.95},{"t":1753165654994,"o":8.95,"h":8.96,"l":8.95,"c":8.96},{"t":1753165737850,"o":8.96,"h":8.96,"l":8.95,"c":8.95},{"t":1753165857796,"o":8.95,"h":8.96,"l":8.95,"c":8.96},{"t":1753165955240,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753166036056,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753166157446,"o":8.96,"h":8.97,"l":8.96,"c":8.97},{"t":1753166256181,"o":8.97,"h":8.97,"l":8.96,"c":8.96},{"t":1753166338305,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753166456374,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753166556233,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753166596359,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753166818889,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753166823183,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753166935205,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753167551585,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753167563134,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753167579381,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753167599227,"o":8.96,"h":8.96,"l":8.95,"c":8.95},{"t":1753167918928,"o":8.95,"h":8.95,"l":8.95,"c":8.95},{"t":1753167963220,"o":8.95,"h":8.95,"l":8.95,"c":8.95},{"t":1753168612195,"o":8.95,"h":8.96,"l":8.95,"c":8.96},{"t":1753172863713,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753172898191,"o":8.96,"h":8.96,"l":8.96,"c":8.96},{"t":1753176066066,"o":8.96,"h":8.96,"l":8.95,"c":8.95},{"t":1753177356252,"o":8.95,"h":8.95,"l":8.94,"c":8.94}]};

    // 1. 时间格式化
    function formatTime(timestamp) {
      const date = new Date(timestamp);
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      return `${month}/${day} ${hours}:${minutes}`;
    }

    // 2. 仅显示时间（用于分时图）
    function formatHourMinute(timestamp) {
      const date = new Date(timestamp);
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      return `${hours}:${minutes}`;
    }

    // 3. 更新系统时间
    function updateSystemTime() {
      try {
        document.getElementById('system-time').textContent = new Date().toLocaleString();
      } catch (e) {
        const date = new Date();
        document.getElementById('system-time').textContent = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
      }
    }
    setInterval(updateSystemTime, 1000);
    updateSystemTime();

    // 4. 处理历史数据（保留原始数据点，不强制补全）
    function processHistoryData(rawData) {
      return rawData
        .filter(item => item && typeof item.t === 'number' && typeof item.c === 'number')
        .sort((a, b) => a.t - b.t); // 仅按时间排序，不做插值
    }

    // 5. 更新数据信息（计数和时间范围）
    function updateDataInfo(type) {
      const data = type === 'gold' ? goldData : silverData;
      if (data.length === 0) return;
      
      document.getElementById(type + '-data-count').textContent = data.length;
      
      const firstTime = formatHourMinute(data[0].t);
      const lastTime = formatHourMinute(data[data.length - 1].t);
      document.getElementById(type + '-time-range').textContent = `${firstTime} - ${lastTime}`;
    }

    // 6. 更新价格显示
    function updatePriceDisplay() {
      // 处理黄金数据
      if (goldData.length > 0) {
        const latest = goldData[goldData.length - 1];
        const openPrice = goldData[0].o || goldData[0].c;
        const currentPrice = latest.c;
        const changePercent = ((currentPrice - openPrice) / openPrice * 100).toFixed(2);
        
        const highPrice = Math.max.apply(null, goldData.map(item => item.h));
        const lowPrice = Math.min.apply(null, goldData.map(item => item.l));
        
        document.getElementById('gold-price').textContent = currentPrice.toFixed(2);
        document.getElementById('gold-open').textContent = openPrice.toFixed(2);
        document.getElementById('gold-high').textContent = highPrice.toFixed(2);
        document.getElementById('gold-low').textContent = lowPrice.toFixed(2);
        document.getElementById('gold-time').textContent = formatTime(latest.t);
        
        const goldChangeEl = document.getElementById('gold-change');
        goldChangeEl.textContent = (changePercent >= 0 ? '+' : '') + changePercent + '%（今日）';
        goldChangeEl.className = changePercent >= 0 ? 'text-success' : 'text-danger';
      }
      
      // 处理白银数据
      if (silverData.length > 0) {
        const latest = silverData[silverData.length - 1];
        const openPrice = silverData[0].o || silverData[0].c;
        const currentPrice = latest.c;
        const changePercent = ((currentPrice - openPrice) / openPrice * 100).toFixed(2);
        
        const highPrice = Math.max.apply(null, silverData.map(item => item.h));
        const lowPrice = Math.min.apply(null, silverData.map(item => item.l));
        
        document.getElementById('silver-price').textContent = currentPrice.toFixed(2);
        document.getElementById('silver-open').textContent = openPrice.toFixed(2);
        document.getElementById('silver-high').textContent = highPrice.toFixed(2);
        document.getElementById('silver-low').textContent = lowPrice.toFixed(2);
        document.getElementById('silver-time').textContent = formatTime(latest.t);
        
        const silverChangeEl = document.getElementById('silver-change');
        silverChangeEl.textContent = (changePercent >= 0 ? '+' : '') + changePercent + '%（今日）';
        silverChangeEl.className = changePercent >= 0 ? 'text-success' : 'text-danger';
      }
    }

    // 7. 初始化黄金图表（精确标注XY轴）
    function initGoldChart() {
      try {
        showLoading('gold');
        
        const ctx = document.getElementById('gold-line').getContext('2d');
        
        if (goldLineChart) {
          goldLineChart.destroy();
        }
        
        // 准备原始数据点
        const chartData = goldData.map(item => ({
          x: new Date(item.t),
          y: item.c
        }));
        
        if (chartData.length === 0) {
          throw new Error('无黄金数据');
        }
        
        // 获取价格范围，放大波动显示
        const prices = chartData.map(d => d.y);
        const minPrice = Math.min(...prices);
        const maxPrice = Math.max(...prices);
        const priceRange = maxPrice - minPrice;
        // 价格轴上下留10%的余量，确保波动可见
        const suggestedMin = priceRange > 0 ? minPrice - priceRange * 0.1 : minPrice - 0.5;
        const suggestedMax = priceRange > 0 ? maxPrice + priceRange * 0.1 : maxPrice + 0.5;
        
        // 开盘价参考线
        const openPrice = goldData[0].o || goldData[0].c;
        
        goldLineChart = new Chart(ctx, {
          type: 'line',
          data: {
            datasets: [
              {
                label: '黄金价格',
                data: chartData,
                borderColor: '#0071e3',
                backgroundColor: 'rgba(0, 113, 227, 0.05)',
                borderWidth: 2,
                pointRadius: 2,       // 显示数据点
                pointHoverRadius: 5,  // 鼠标悬停放大
                tension: 0.4,         // 适度平滑，保留原始趋势
                fill: true
              },
              {
                label: '开盘价',
                data: [
                  { x: chartData[0].x, y: openPrice },
                  { x: chartData[chartData.length - 1].x, y: openPrice }
                ],
                borderColor: '#86868b',
                borderWidth: 1.5,
                borderDash: [5, 5],
                pointRadius: 0,
                fill: false
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              intersect: false,
              mode: 'index'
            },
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  boxWidth: 12,
                  usePointStyle: true
                }
              },
              tooltip: {
                backgroundColor: 'rgba(29, 29, 31, 0.9)',
                titleFont: { size: 13 },
                bodyFont: { size: 13 },
                callbacks: {
                  label: ctx => `价格: ${ctx.raw.y.toFixed(2)} 元/克`,
                  title: ctx => formatTime(new Date(ctx[0].raw.x))
                }
              }
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: '时间',
                  color: '#86868b',
                  font: { size: 12 }
                },
                grid: { display: false },
                ticks: {
                  color: '#86868b',
                  maxRotation: 0,
                  callback: value => {
                    const date = new Date(value);
                    return `${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                  }
                }
              },
              y: {
                title: {
                  display: true,
                  text: '价格（元/克）',
                  color: '#86868b',
                  font: { size: 12 }
                },
                grid: { color: 'rgba(0, 0, 0, 0.05)' },
                ticks: {
                  color: '#86868b',
                  callback: v => v.toFixed(2)
                },
                suggestedMin: suggestedMin,
                suggestedMax: suggestedMax
              }
            },
            animation: {
              duration: 1000
            }
          }
        });
        
        hideLoading('gold');
        hideError('gold');
        
      } catch (e) {
        console.error('黄金图表初始化失败:', e);
        hideLoading('gold');
        showError('gold');
      }
    }

    // 8. 初始化白银图表
    function initSilverChart() {
      try {
        showLoading('silver');
        
        const ctx = document.getElementById('silver-line').getContext('2d');
        
        if (silverLineChart) {
          silverLineChart.destroy();
        }
        
        const chartData = silverData.map(item => ({
          x: new Date(item.t),
          y: item.c
        }));
        
        if (chartData.length === 0) {
          throw new Error('无白银数据');
        }
        
        // 价格范围处理
        const prices = chartData.map(d => d.y);
        const minPrice = Math.min(...prices);
        const maxPrice = Math.max(...prices);
        const priceRange = maxPrice - minPrice;
        const suggestedMin = priceRange > 0 ? minPrice - priceRange * 0.1 : minPrice - 0.05;
        const suggestedMax = priceRange > 0 ? maxPrice + priceRange * 0.1 : maxPrice + 0.05;
        
        // 开盘价参考线
        const openPrice = silverData[0].o || silverData[0].c;
        
        silverLineChart = new Chart(ctx, {
          type: 'line',
          data: {
            datasets: [
              {
                label: '白银价格',
                data: chartData,
                borderColor: '#86868b',
                backgroundColor: 'rgba(134, 134, 139, 0.05)',
                borderWidth: 2,
                pointRadius: 2,
                pointHoverRadius: 5,
                tension: 0.4,
                fill: true
              },
              {
                label: '开盘价',
                data: [
                  { x: chartData[0].x, y: openPrice },
                  { x: chartData[chartData.length - 1].x, y: openPrice }
                ],
                borderColor: '#86868b',
                borderWidth: 1.5,
                borderDash: [5, 5],
                pointRadius: 0,
                fill: false
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              intersect: false,
              mode: 'index'
            },
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  boxWidth: 12,
                  usePointStyle: true
                }
              },
              tooltip: {
                backgroundColor: 'rgba(29, 29, 31, 0.9)',
                titleFont: { size: 13 },
                bodyFont: { size: 13 },
                callbacks: {
                  label: ctx => `价格: ${ctx.raw.y.toFixed(2)} 元/克`,
                  title: ctx => formatTime(new Date(ctx[0].raw.x))
                }
              }
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: '时间',
                  color: '#86868b',
                  font: { size: 12 }
                },
                grid: { display: false },
                ticks: {
                  color: '#86868b',
                  maxRotation: 0,
                  callback: value => {
                    const date = new Date(value);
                    return `${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                  }
                }
              },
              y: {
                title: {
                  display: true,
                  text: '价格（元/克）',
                  color: '#86868b',
                  font: { size: 12 }
                },
                grid: { color: 'rgba(0, 0, 0, 0.05)' },
                ticks: {
                  color: '#86868b',
                  callback: v => v.toFixed(2)
                },
                suggestedMin: suggestedMin,
                suggestedMax: suggestedMax
              }
            },
            animation: {
              duration: 1000
            }
          }
        });
        
        hideLoading('silver');
        hideError('silver');
        
      } catch (e) {
        console.error('白银图表初始化失败:', e);
        hideLoading('silver');
        showError('silver');
      }
    }

    // 9. 加载数据（直接使用提供的历史数据）
    function loadData() {
      try {
        // 直接处理提供的历史数据
        goldData = processHistoryData(PROVIDED_HISTORY.gold || []);
        silverData = processHistoryData(PROVIDED_HISTORY.silver || []);
        
        // 更新UI
        updateDataInfo('gold');
        updateDataInfo('silver');
        updatePriceDisplay();
        initGoldChart();
        initSilverChart();
        
      } catch (error) {
        console.error('数据加载失败:', error);
        showError('gold');
        showError('silver');
      }
    }

    // 辅助函数：显示/隐藏加载和错误状态
    function showLoading(type) {
      document.getElementById(type + '-chart-loading').classList.remove('hidden');
    }
    function hideLoading(type) {
      document.getElementById(type + '-chart-loading').classList.add('hidden');
    }
    function showError(type) {
      document.getElementById(type + '-chart-error').classList.remove('hidden');
    }
    function hideError(type) {
      document.getElementById(type + '-chart-error').classList.add('hidden');
    }

    // 初始化页面
    function init() {
      // 绑定刷新按钮事件
      document.getElementById('refresh-gold').addEventListener('click', () => {
        initGoldChart();
      });
      document.getElementById('refresh-silver').addEventListener('click', () => {
        initSilverChart();
      });
      
      // 加载数据
      loadData();
    }
